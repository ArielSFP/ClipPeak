================================================================================
ClipPeak - Copy & Paste This into Google Cloud Shell
================================================================================

1. Open Google Cloud Shell at: console.cloud.google.com
2. Click the terminal icon (>_) in top right
3. Copy and paste the commands below ONE SECTION AT A TIME
4. Replace YOUR_PROJECT_ID with your actual project ID

================================================================================
SECTION 1: Initial Setup
================================================================================

export PROJECT_ID="your-project-id-here"
gcloud config set project $PROJECT_ID
git clone https://github.com/ArielSFP/ClipPeak.git
cd ClipPeak

================================================================================
SECTION 2: Enable APIs (takes 2 minutes)
================================================================================

gcloud services enable run.googleapis.com
gcloud services enable artifactregistry.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable secretmanager.googleapis.com

echo "âœ… APIs enabled"

================================================================================
SECTION 3: Create Artifact Registry
================================================================================

gcloud artifacts repositories create clippeak-repo \
    --repository-format=docker \
    --location=europe-west1 \
    --description="ClipPeak Docker images"

echo "âœ… Registry created"

================================================================================
SECTION 4: Create Secrets (API Keys)
================================================================================

# OpenAI API Key
echo -n "sk-proj-YOUR_OPENAI_KEY" | gcloud secrets create openai-api-key --data-file=-

# Supabase URL
echo -n "https://bzyclxmakfklbxnsradh.supabase.co/" | gcloud secrets create supabase-url --data-file=-

# Supabase Key
echo -n "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." | gcloud secrets create supabase-key --data-file=-

echo "âœ… Secrets created"

================================================================================
SECTION 5: Grant Secret Access
================================================================================

PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format="value(projectNumber)")
SERVICE_ACCOUNT="$PROJECT_NUMBER-compute@developer.gserviceaccount.com"

for SECRET in openai-api-key supabase-url supabase-key; do
    gcloud secrets add-iam-policy-binding $SECRET \
        --member=serviceAccount:$SERVICE_ACCOUNT \
        --role=roles/secretmanager.secretAccessor
done

echo "âœ… Access granted"

================================================================================
SECTION 6: Build Docker Image (takes 20-30 minutes)
================================================================================

gcloud builds submit \
    --tag europe-west1-docker.pkg.dev/$PROJECT_ID/clippeak-repo/clippeak-api:latest \
    --timeout=45m \
    --machine-type=e2-highcpu-8

echo "âœ… Image built"

================================================================================
SECTION 7: Deploy to Cloud Run (takes 5-10 minutes)
================================================================================

gcloud run deploy clippeak-api \
    --image=europe-west1-docker.pkg.dev/$PROJECT_ID/clippeak-repo/clippeak-api:latest \
    --region=europe-west1 \
    --platform=managed \
    --allow-unauthenticated \
    --gpu=1 \
    --gpu-type=nvidia-l4 \
    --memory=16Gi \
    --cpu=8 \
    --timeout=3600 \
    --max-instances=2 \
    --min-instances=0 \
    --concurrency=1 \
    --port=8080 \
    --set-secrets=OPENAI_API_KEY=openai-api-key:latest,SUPABASE_URL=supabase-url:latest,SUPABASE_KEY=supabase-key:latest

echo "âœ… Deployed!"

================================================================================
SECTION 8: Get Your Service URL
================================================================================

SERVICE_URL=$(gcloud run services describe clippeak-api --region=europe-west1 --format='value(status.url)')
echo "ðŸŽ‰ Service URL: $SERVICE_URL"
echo ""
echo "Test it: curl $SERVICE_URL/health"

================================================================================
DONE! Update your website to use $SERVICE_URL
================================================================================

Next steps:
1. Test: curl $SERVICE_URL/health
2. Update clippeak.co.il to use this URL
3. Upload a test video
4. Check logs: gcloud run services logs tail clippeak-api --region=europe-west1
5. Monitor costs: console.cloud.google.com/billing

================================================================================

